<div class="post-card _fw ng-class:{'forward-card': ctlPostCard.post.isForwarded ,'reply-card': ctlPostCard.post.isReplyed, 'unread' : !ctlPostCard.post.isRead, 'ribbon' : ctlPostCard.isRibbon }" ng-if="!ctlPostCard.post.forbidden">
  <section class="collapse-view" ng-if="ctlPostCard.isRibbon && ctlPostCard.ribbonEnabled" ng-click="ctlPostCard.switchToPostCard();">
    <div class="user-avatar-24" user-detail user="{{::ctlPostCard.post.sender}}">
      <img initials="ctlPostCard.post.sender.name" data-url="ctlPostCard.post.sender.avatar" data-width="24"
           data-height="24"
           data-radius="30" class="account-initials-24 _df" data-word-count="2" data-font-size="12"/>
    </div>
    <p ng-if="ctlPostCard.post.subject.length > 0" ng-bind-html="ctlPostCard.post.subject"></p>
    <p ng-if="!ctlPostCard.post.subject.length > 0" ng-bind-html="ctlPostCard.post.body | removeHTMLTags | truncate"></p>
  </section>

  <section class="post-head _difh" ng-if="(!ctlPostCard.isRibbon || !ctlPostCard.ribbonEnabled)">
    <div class="_difc">
      <div ng-if="ctlPostCard.post.hasAnyAttachment()" class="icon icon-post-head icon-attached"></div>
      <a ng-click="ctlPostCard.viewFull($event);" ng-if="ctlPostCard.post.isForwarded" class="icon" ui-sref="app.message({ postId : ctlPostCard.post.id })">
        <div class="fw">
          <svg class="svg-hover">
            <use xlink:href="/assets/icons/nst-icn20.svg#forwarded"></use>
            <use xlink:href="/assets/icons/nst-icn20.svg#forwarded"></use>
          </svg>
        </div>
      </a>
      <a ng-click="ctlPostCard.viewFull($event);" ng-if="ctlPostCard.post.isReplyed" class="icon" ui-sref="app.message({ postId : ctlPostCard.post.id })">
        <div class="re">
          <svg class="svg-hover">
            <use xlink:href="/assets/icons/nst-icn20.svg#replied"></use>
            <use xlink:href="/assets/icons/nst-icn20.svg#replied"></use>
          </svg>
        </div>
      </a>
    </div>
    <div class="img _df">
      <div class="user-avatar-38" user-detail user="{{::ctlPostCard.post.sender}}">
        <img initials="ctlPostCard.post.sender.name" data-url="ctlPostCard.post.sender.avatar" data-width="38"
             data-height="38"
             data-radius="30" class="account-initials-38 _df" data-word-count="2" data-font-size="16"/>
      </div>
    </div>
    <div class="_fw _difc">
      <h4 class="_df _fn" user-detail user="{{::ctlPostCard.post.sender}}">{{::ctlPostCard.post.sender.name}}</h4>
      <div class="_df _fw">
      </div>
      <span class="_df _fn post-card-time" data-uib-tooltip="{{::ctlPostCard.post.date | date : 'full'}}"
            data-tooltip-append-to-body="true" data-tooltip-placement="auto left" ng-click="ctlPostCard.markAsRead()">
        {{::ctlPostCard.post.date | date : 'short'}}
        <div class="unread-badge-holder">‚óè</div>
      </span>
    </div>
    <div class="pin-post ng-class:{'pinned' : ctlPostCard.post.bookmarked}" ng-click="ctlPostCard.setBookmark(!ctlPostCard.post.bookmarked)">
      <svg class="_24svg" data-ng-if="ctlPostCard.post.bookmarked">
        <use xlink:href="/assets/icons/nst-icn24.svg#bookmark"></use>
      </svg>
      <svg class="_24svg" data-ng-if="!ctlPostCard.post.bookmarked">
        <use xlink:href="/assets/icons/nst-icn24.svg#bookmark-wire"></use>
      </svg>
    </div>
  </section>

  <section ng-if="ctlPostCard.post.subject.length > 0 && (!ctlPostCard.isRibbon || !ctlPostCard.ribbonEnabled)" class="post-subject"
           auto-dir="ctlPostCard.post.subject">
    <h3 class="_wrb" ng-if="ctlPostCard.post.subject.length > 0" ng-bind-html="ctlPostCard.post.subject">
    </h3>
  </section>

  <section class="post-body _wrb {{ctlPostCard.post.contentType == 'text/plain' ? 'pre' : ''}}"
           ng-if="ctlPostCard.post.body.length > 0 && (!ctlPostCard.isRibbon || !ctlPostCard.ribbonEnabled)"
           auto-dir="ctlPostCard.post.body">
    <span ng-if="!ctlPostCard.isExpanded" ng-bind-html="ctlPostCard.body | removeHTMLTags | truncate"></span>
    <span ng-if="ctlPostCard.isExpanded" ng-bind-html="ctlPostCard.body"></span>
  </section>

  <section  ng-if="!ctlPostCard.expandProgress && ctlPostCard.post.ellipsis && (!ctlPostCard.isRibbon || !ctlPostCard.ribbonEnabled)">
    <a ng-click="$event.stopPropagation();ctlPostCard.collapse();" ng-if="ctlPostCard.isExpanded">Show less</a>
    <a ng-click="$event.stopPropagation();ctlPostCard.expand();" ng-if="!ctlPostCard.isExpanded">
      <translate>Show more...</translate>
    </a>
  </section>

  <div class="_difh nst-mood-cheerful no-gutter" ng-if="ctlPostCard.expandProgress">
    <div class="col-xs-6">
      <div class="nst-loading nst-loading-size-16  _fr"></div>
    </div>
    <div class="col-xs-6 nst-marginbtm-4">
      <translate>Loading...</translate>
    </div>
  </div>

  <section data-ng-if="ctlPostCard.post.hasAnyAttachment() && (!ctlPostCard.isRibbon || !ctlPostCard.ribbonEnabled)" class="attachments-card">
    <nst-attachments-view class="_fw" post-id="ctlPostCard.post.id" attachments="ctlPostCard.post.attachments"></nst-attachments-view>
  </section>

  <section class="post-places" ng-if="(!ctlPostCard.isRibbon || !ctlPostCard.ribbonEnabled)">
    <a href="#/places/{{place.id}}/messages" ng-if="ctlPostCard.post.getAllPlacesCount() > 0"
       data-ng-repeat="place in ctlPostCard.post.allPlaces" class="ng-class:{'del-access' : place.hasDeleteAccess}">#{{place.name}}
      <svg class="_16svg red" ng-click="$event.stopPropagation();ctlPostCard.remove(place.id);">
        <use xlink:href="/assets/icons/nst-icn16.svg#bin"></use>
      </svg>
    </a>
    <a ng-if="ctlPostCard.post.recipients.length > 0"
       data-ng-repeat="recipient in ctlPostCard.post.recipients">{{recipient.id}}
    </a>
  </section>

  <hr ng-if="(!ctlPostCard.isRibbon || !ctlPostCard.ribbonEnabled)">

  <section class="post-footer _difh" ng-if="(!ctlPostCard.isRibbon || !ctlPostCard.ribbonEnabled) && !ctlPostCard.chainView">
    <script type="text/ng-template" id="more-uib-tooltip.html">
      <translate>More options</translate>
    </script>
    <script type="text/ng-template" id="reply-to-all-uib-tooltip.html">
      <translate>Reply to all</translate>
    </script>
    <script type="text/ng-template" id="forward-uib-tooltip.html">
      <translate>Forward</translate>
    </script>
    <a class="_df _fn comments-count" ng-if="ctlPostCard.unreadCommentsCount == 0 ">
      <svg class="_16svg">
        <use xlink:href="/assets/icons/nst-icn16.svg#comment"></use>
      </svg>
      <span>{{ctlPostCard.post.commentsCount}}</span>
    </a>
    <a class="_df _fn comments-count new-comments-count" ng-if="ctlPostCard.unreadCommentsCount > 0 "
       ui-sref="app.message({ postId : ctlPostCard.post.id })" ng-click="ctlPostCard.viewFull($event)" >
      <!--fixme :: set blue icon-->
      <svg class="_16svg">
        <use xlink:href="/assets/icons/nst-icn16.svg#comment"></use>
      </svg>
      <span ng-if="ctlPostCard.unreadCommentsCount == 1"><translate>1 new comment</translate></span>
      <span ng-if="ctlPostCard.unreadCommentsCount > 1"><translate>{{ctlPostCard.unreadCommentsCount}} new comments</translate></span>
    </a>

    <div class="post-icons _fw _df">
      <a id="test-forward" ui-sref="app.compose-forward({ postId: ctlPostCard.post.id })" ng-click="ctlPostCard.forward($event);" class="icon _df">
        <div class="fw">
          <svg class="svg-hover _24svg">
            <use xlink:href="/assets/icons/nst-icn24.svg#forward"></use>
            <use xlink:href="/assets/icons/nst-icn24.svg#forward"></use>
          </svg>
        </div>
      </a>
      <a id="test-reply" class="icon _df" ng-click="ctlPostCard.replyAll($event)" ui-sref="app.compose-reply-all({ postId: ctlPostCard.post.id })">
        <div class="re">
          <svg class="svg-hover _24svg">
            <use xlink:href="/assets/icons/nst-icn24.svg#reply"></use>
            <use xlink:href="/assets/icons/nst-icn20.svg#reply"></use>
          </svg>
        </div>
      </a>
      <div ng-click="$event.stopPropagation()" class="cursor-pointer margin-r_5 icon _df" popover-class="white-pop popover-white-nst-activity-places" data-popover-placement="{{$root._direction == 'ltr' ? 'left auto' : 'right auto'}}"
             data-uib-popover-template="'app/messages/partials/popovers/post-card-more-option.html'"  data-popover-append-to-body="false" translate-attrs="data-uib-tooltip">
        <div class="more">
          <svg class="svg-hover _24svg">
            <use xlink:href="/assets/icons/nst-icn24.svg#more"></use>
            <use xlink:href="/assets/icons/nst-icn24.svg#more"></use>
          </svg>
        </div>
      </div>
    </div>
  </section>

  <vr class="chain"></vr>
</div>

<section class="post-card-comment" data-ng-if="!ctlPostCard.hideComments && !ctlPostCard.post.forbidden && ctlPostCard.commentBoard">
  <comments-board comments="ctlPostCard.post.comments" limit="ctlPostCard.commentBoardLimit" post-id="ctlPostCard.post.id" total-comments-count="ctlPostCard.post.commentsCount" on-comment-sent="ctlPostCard.onAddComment"></comments-board>
</section>

<div class="chain-forward" ng-if="ctlPostCard.chainView && (!ctlPostCard.isRibbon || !ctlPostCard.ribbonEnabled)">
  <a ng-click="ctlPostCard.replyAll($event)" ui-sref="app.compose-reply-all({ postId: ctlPostCard.post.id })">
    <svg>
      <use xlink:href="/assets/icons/nst-icn20.svg#reply"></use>
    </svg>
  </a>
  <a ui-sref="app.compose-forward({ postId: ctlPostCard.post.id })" ng-click="ctlPostCard.forward($event);">
    <svg>
      <use xlink:href="/assets/icons/nst-icn20.svg#forward"></use>
    </svg>
  </a>
  <a ng-if="ctlPostCard.addOn" popover-class="white-pop popover-white-nst-activity-places" data-popover-placement="bottom-left auto"
     data-uib-popover-template="'app/messages/partials/popovers/post-card-more-option.html'" data-popover-append-to-body="true" translate-attrs="data-uib-popover">
    <svg class="_r90">
      <use xlink:href="/assets/icons/nst-icn20.svg#more"></use>
    </svg>
  </a>
</div>
<div class="chain-stats" ng-if="ctlPostCard.chainView">
  <div ng-if="!ctlPostCard.addOn">
    <div class="circ ng-class:{'blue' : ctlPostCard.post.isReplyed, 'green' : ctlPostCard.post.isForwarded}"></div>
  </div>
  <div ng-if="ctlPostCard.addOn" class="isNotRF">
    <svg>
      <use xlink:href="/assets/icons/nst-icn16.svg#message"></use>
    </svg>
  </div>

  <div ng-if="ctlPostCard.addOn">
    <div class="squ"></div><span>shared in {{ctlPostCard.post.getAllPlacesCount()}} places</span>
  </div>
  <div ng-if="ctlPostCard.addOn">
    <svg class="chain-ico">
      <use xlink:href="/assets/icons/nst-icn16.svg#more"></use>
    </svg>
    <span ng-if="!ctlPostCard.post.hasAnyComment()"><translate>No comments</translate></span>
    <span ng-if="ctlPostCard.post.commentsCount == 1"><translate>One comment</translate></span>
    <span ng-if="ctlPostCard.post.commentsCount > 1"><translate>{{ctlPostCard.post.commentsCount}} comments</translate></span>
  </div>
</div>

<div class="post-card-wire" ng-if="!ctlPostCard.chainView" ></div>
