<nst-navbar data-ng-model="navbar"
            place-id="{{ctlMessages.currentPlace.id}}"
            show-place-id="ctlMessages.showPlaceId"
            nav-title="{{ctlMessages.currentPlace.id?ctlMessages.currentPlace.name: ctlMessages.navTitle}}"
            nav-picture-url="{{ctlMessages.currentPlace.id ? ctlMessages.currentPlace.picture.thumbnails.x64.url.view : '' }}"
            nav-picture-class="{{ !ctlMessages.currentPlace.id? ctlMessages.navIconClass : '' }}"
            ready-to-show="ctlMessages.currentPlaceLoaded"
            ready-to-anime="true"
            place-description="{{ctlMessages.currentPlace.description}}"></nst-navbar>

<div class="nst-content _tr" id="content-wrapper" data-droplet ng-model="ctlMessages.attachfiles">
  <div class="droplet" ng-show="ctlMessages.quickMessageAccess"></div>
  <scroll-change-handler reached-bottom="ctlMessages.loadMore"></scroll-change-handler>
  <section class="content nst-marginbtm-28">
    <div class="navbarillu"></div>
    <div class="filter-bar _fw" ng-mouseleave="popoverSortShow = false;popoverSetShow = false">
      <div ng-show="!ctlMessages.isBookmarkMode" ng-mouseenter="popoverSortShow = true;popoverSetShow = false" class="iconsblock"
           data-popover-class="white-pop popover-white-nst-sort" uib-popover-template="'app/messages/partials/popovers/sort_popover.html'"
           data-popover-placement="bottom-center" data-popover-is-open="popoverSortShow" id="test-filter-sort">
        <span class="nst-mood-storm _df" ng-if="ctlMessages.messagesSetting.sort == 'latest-messages'"><translate>Latest Messages</translate></span>
        <span class="nst-mood-storm _df" ng-if="ctlMessages.messagesSetting.sort != 'latest-messages'"><translate>Latest Activity</translate></span>
        <div class="icon icon-viewicon-sort _df" ></div>
      </div>
      <div ng-mouseenter="popoverSetShow = true;popoverSortShow = false"  class="iconsblock" data-popover-class="white-pop popover-white-nst-setting"
           uib-popover-template="'app/messages/partials/popovers/setting_popover.html'"
           data-popover-placement="bottom-center" data-popover-is-open="popoverSetShow" ng-init="ctl = ctlMessages" id="test-filter-setting">
        <div class="icon icon-viewicon- "></div>
      </div>
    </div>

    <div class="post-area">
      <div id="new-post"  ng-show="ctlMessages.hasNewMessages" affixer parent=".content" offset-top="74" after-content="340">
        <i ng-click="ctlMessages.dismissNewMessage();"></i>
        <a ng-click="ctlMessages.showNewMessages();" ng-if="ctlMessages.hotMessageStorage.length > 1">{{ctlMessages.hotMessageStorage.length}} <translate> New Message</translate></a>
        <a ng-click="ctlMessages.showNewMessages();" ng-if="ctlMessages.hotMessageStorage.length < 2"><translate>One New Message</translate></a>
      </div>
      <div class="quick-message-wrp _fw" ng-if="ctlMessages.quickMessageAccess">
        <nst-quick-message class="quick-message _fw _bgwhite" place-id="ctlMessages.currentPlace.id"></nst-quick-message>
        <div class="post-card-wire"></div>
      </div>
      <post-card ng-if="ctlMessages.hotMessages.length > 0" class="hot" data-ng-repeat="msg in ctlMessages.hotMessages track by msg.id" post="msg"
                 settings="ctlMessages.viewSetting" postinplace="ctlMessages.currentPlaceId" hide-comments="ctlMessages.isSentMode"></post-card>
      <hr ng-if="ctlMessages.hotMessages.length > 0" class="hot-message-separator">

      <post-card class="_fw" data-ng-repeat="msg in ctlMessages.messages track by msg.id" post="msg"
                 settings="ctlMessages.viewSetting" postinplace="ctlMessages.currentPlaceId" hide-comments="ctlMessages.isSentMode" has-remove-access="ctlMessages.placeRemoveAccess"></post-card>
    </div>
    <div class="text-center nst-margin-24" ng-if="ctlMessages.tryAgainToLoadMore">
      <a href="javascript:void(0);" class="nst-mood-cheerful" data-ng-click="ctlMessages.loadMore()" ng-if="ctlMessages.cache.length == 0"><translate>Click here to load messages!</translate></a>
      <a href="javascript:void(0);" class="nst-mood-cheerful" data-ng-click="ctlMessages.loadMore()" ng-if="ctlMessages.cache.length != 0"><translate>Load More...</translate></a>
    </div>

    <div class="nst-margin-24"
         ng-if="ctlMessages.reachedTheEnd || ctlMessages.noMessages || ctlMessages.loadMessageError">
      <p class="text-center nst-mood-storm" ng-if="!ctlMessages.noMessages && ctlMessages.reachedTheEnd">
        <translate>There are no more messages!</translate>
      </p>
      <p class="text-center nst-mood-storm" ng-if="ctlMessages.noMessages && !ctlMessages.isUnreadMode">
        <span ng-if="!ctlMessages.isBookMark">
          <translate>There are no posts here yet...</translate>
        </span>
        <span ng-if="ctlMessages.isBookMark">
          <translate>You haven't favorited any Places yet...</translate>
        </span>
      </p>
      <p class="text-center nst-mood-storm" ng-if="ctlMessages.noMessages && ctlMessages.isUnreadMode">
        <translate>You don't have any unread messages.</translate>
      </p>
      <p class="text-center nst-mood-storm" ng-if="ctlMessages.loadMessageError">An error has occurred. Please
        <a href="javascript:void(0);" class="nst-mood-cheerful" data-ng-click="ctlMessages.loadMore(true)">
          <translate>try again</translate>...</translate>
        </a>
      </p>
    </div>
    <div class="_difh nst-mood-cheerful no-gutter nst-margin-24" ng-if="ctlMessages.loading">
      <div class="col-xs-6">
        <div class="nst-loading nst-loading-size-16  _fr"></div>
      </div>
      <div class="col-xs-6 nst-marginbtm-4"><translate>Loading</translate>...</translate></div>
    </div>
    <div class="nst-marginbtm-32"></div>
  </section>
  <div class="content-plus illu">
    <div id="cp1" nst-scrollbar  ng-show="!ctlMessages.isBookmarkMode && !ctlMessages.isSentMode && !ctlMessages.isUnreadMode" affixer parent=".content-plus" offset-top="74" top="0" fixed-top="true">
      <!--FIXME:: use only one of place/place-id -->
      <nst-recent-activity place="ctlMessages.currentPlaceId" place-id="ctlMessages.currentPlaceId"  count="10"/>
    </div>
  </div>
  <div class="content-plus" id="content-plus"></div>
</div>
<scroll-roller roll-upward="ctlMessages.revealHotMessage"></scroll-roller>
