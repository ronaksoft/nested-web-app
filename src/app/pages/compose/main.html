<div class="_fh _pr _fw" id="compose-box"
     ondrop="angular.element(document.getElementById('compose-box')).scope().ctlCompose.dodrop(event);">
  <div class="compose-wrp" ng-mouseleave="ctlCompose.mouseIn = false" ng-mouseenter="ctlCompose.mouseIn = true">
    <div class="modal-head" ng-if="!ctlCompose.quickMode">
      <svg class="_20svg" id="compose-full" ng-click="ctlCompose.fullCompose()">
        <use xlink:href="/assets/icons/nst-icn16.svg#expand"></use>
        <use xlink:href="/assets/icons/nst-icn16.svg#collapse"></use>
      </svg>
      <svg class="_20svg _r45" ng-click="$dismiss()">
        <use xlink:href="/assets/icons/nst-icn16.svg#cross"></use>
      </svg>
    </div>
    <div class="modal-bo _difv _fw" nst-scrollbar suppress-scroll-x="true" suppress-scroll-y="{{ctlCompose.quickMode}}" go-upward="ctlCompose.makeChangeForWatchers">
      <p class="_df _fn" ng-if="!ctlCompose.quickMode"><translate>Share With</translate></p>
      <div ng-if="!ctlCompose.quickMode" class="_df _fw input-select-match">
        <ui-select minimum-input-length="4" multiple limit="10"  class="address-input _dib"
                   id="input-compose-to"
                   data-ng-model="ctlCompose.model.recipients">
          <ui-select-match placeholder="{{::ctlCompose.inputPlaceHolderLabel}}">
            <div class="selected-innter " ng-class="{'isEmail' : $item.isEmail,'error' : !$item.isEmailValid}">
              <span class="place-img" ng-if="!$item.isEmail">
                <img ng-if="$item.avatar" ng-src="{{::$item.avatar }}"/>
                <img ng-if="$item.data.picture" ng-src="{{$item.data | picture }}"/>
                <img ng-if="!$item.data.picture" src="/assets/icons/absents_place.svg"/>
              </span>
              <span class="place-img" ng-if="$item.isEmail && !$item.isEmailValid">
                  <svg>
                    <use xlink:href="/assets/icons/nst-icn16.svg#exclamation-mark"></use>
                  </svg>
                </span>
              <span class="place-name">{{$item.name}}</span>
            </div>

          </ui-select-match>
          <ui-select-choices refresh="ctlCompose.search.fn($select.search)"
                             refresh-delay="0"
                             repeat="place as place in (ctlCompose.search.results | filter: $select.search ) track by $index">
            <img class="account-initials-32" ng-src="{{::place.avatar}}"/>
            <span class="" data-ng-bind-html="place.name | highlight: $select.search"></span>
            <br/>
            <span class="nst-font-10 _vat margin-l-50">{{::place.id}}</span>
          </ui-select-choices>
        </ui-select>
      </div>
      <section class="_difc _fw _fn">
        <input class="compose-input _fw" name="subject" ng-focus="ctlCompose.focusBox()" ng-blur="ctlCompose.blurBox()" ng-keydown="ctlCompose.subjectKeyDown($event)" placeholder="Add a subject line..."
               data-ng-model="ctlCompose.model.subject" auto-dir="ctlCompose.model.subject" translate-attrs="placeholder" autocomplete="off">
      </section>

      <section class="nst-compose-message ng-class:{'focussed' : ctlCompose.focus || ctlCompose.attachments.viewModels.length > 0,'empty' : ctlCompose.model.body.length == 0}" id="editor-txt">
        <textarea  ckeditor="editorOptions" ng-model="ctlCompose.model.body" ng-blur="ctlCompose.blurBox()" id="composeEditor"></textarea>
        <!--<summernote focus ng-model="ctlCompose.model.body"></summernote>-->
        <!--<textarea  nst-mention="#" ui-tinymce="ctlCompose.configs.tinymce"-->
                   <!--placeholder="Your message goes here..." data-ng-model="ctlCompose.model.body"  translate-attrs="placeholder"></textarea>-->
        <!--<textarea  nst-mention="#" page-change-element ui-tinymce="ctlCompose.configs.tinymce"-->
        <!--placeholder="Your message goes here..." data-ng-model="ctlCompose.model.body"  translate-attrs="placeholder"></textarea>-->
      </section>

      <form name="attachmentForm">
        <input type="hidden" name="attLength" data-ng-model="ctlCompose.model.attachments.length"/>
      </form>

      <div class="nst-attach _dif" data-ng-show="ctlCompose.attachments.viewModels.length > 0">
        <div class="_fw _pr">
          <nst-attachments-editable-bar mode="thumbnail" items="ctlCompose.attachments.viewModels" on-item-delete="ctlCompose.attachments.detach"></nst-attachments-editable-bar>
        </div>
        <div class="attach _df">
          <input id="attach" type="file" multiple onchange="angular.element(this).scope().ctlCompose.attachments.fileSelected(event)"/>
        </div>
        <div class="nst-attach-con _fh" ng-if="showUploadProgress">
          <div class="progress">
            <div class="progress-bar" ng-class="{'progress-bar-success' : totalProgress == 100}" role="progressbar" aria-valuenow="{{totalProgress}}" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em; width: {{totalProgress}}%;">
              <span>{{totalProgress}}%</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-ft _fw _aic ng-class:{'focussed' : ctlCompose.focus}">
      <div class="compose-btns">
        <label class="_df _fn" for="attach">
          <svg class="_24svg _asc">
            <use xlink:href="/assets/icons/nst-icn24.svg#attach"></use>
          </svg>
        </label>
        <div class="_df f1" id="editor-btn"></div>
      </div>
      <div class="quick-btns">
        <input type="button" ng-click="ctlCompose.clear()" class="butn-white" value="Discard" ng-if="ctlCompose.quickMode" translate-attrs="value">
        <input type="button" ng-click="ctlCompose.send()" class="butn-green" value="Share" translate-attrs="value">
      </div>

    </div>

  </div>
</div>
